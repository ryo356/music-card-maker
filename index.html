<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Music Card Maker</title>

<style>
:root{
  --bg:#0b1020;
  --ink:#e9ecff;
  --muted:#aab2d5;
  --accent:#53f3a6;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui,-apple-system,"Segoe UI","Noto Sans JP",sans-serif;
  background:var(--bg);
  color:var(--ink);
  padding-bottom:96px;
}
header{
  position:sticky;top:0;
  background:rgba(11,16,32,.75);
  backdrop-filter:blur(10px);
  padding:12px 14px;
  z-index:10;
}
.wrap{max-width:960px;margin:auto;padding:14px}
.panel{
  background:rgba(18,26,51,.55);
  border-radius:18px;
  padding:14px;
  margin-bottom:14px;
}
label{font-size:12px;color:var(--muted)}
input,textarea{
  width:100%;padding:12px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.1);
  border-radius:14px;
  color:var(--ink);
  font-size:16px;
}
textarea{min-height:120px}

.seg{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.chip{
  padding:8px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.06);
  font-size:13px;
  font-weight:700;
  cursor:pointer;
}
.chip.on{
  background:rgba(83,243,166,.2);
  border-color:rgba(83,243,166,.5);
}

input[type="range"]{
  -webkit-appearance:none;
  width:100%;
  height:6px;
  border-radius:999px;
  background:rgba(255,255,255,.25);
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:22px;height:22px;
  border-radius:50%;
  background:var(--accent);
}

.timeRow{
  display:flex;justify-content:space-between;
  font-size:12px;color:var(--muted);
}

canvas{width:100%;border-radius:18px}

.btnbar{
  position:fixed;left:0;right:0;bottom:0;
  background:rgba(11,16,32,.8);
  backdrop-filter:blur(10px);
  padding:10px;
  display:flex;gap:10px;
}
button{
  flex:1;
  padding:14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.15);
  background:rgba(83,243,166,.15);
  color:var(--ink);
  font-weight:800;
}
</style>
</head>

<body>
<header>ğŸ§ Music Card Maker</header>

<div class="wrap">
<div class="panel">
  <label>æ›²å</label>
  <input id="title" value="æ˜¥é›·">

  <label>ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</label>
  <input id="artist" value="ç±³æ´¥ç„å¸«">

  <label>ã‚¸ãƒ£ã‚±å†™</label>
  <input type="file" id="cover" accept="image/*">

  <label>ãƒ†ãƒ¼ãƒ</label>
  <div class="seg">
    <div class="chip on" data-theme="dark">Dark</div>
    <div class="chip" data-theme="crimson">Crimson</div>
    <div class="chip" data-theme="mono">Mono</div>
  </div>

  <label>UI</label>
  <div class="seg">
    <div class="chip on" data-ui="spotify">Spotifyé¢¨</div>
    <div class="chip" data-ui="minimal">Minimal</div>
  </div>

  <label>ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
  <div class="seg">
    <div class="chip on" id="toggleLyrics">æ­Œè© ON</div>
    <div class="chip" id="toggleFrame">æ  OFF</div>
  </div>

  <label>æ›²ã®é•·ã•ï¼ˆç§’ï¼‰</label>
  <input id="duration" type="number" value="206">

  <label>å†ç”Ÿä½ç½®</label>
  <input id="pos" type="range" min="0" value="103">
  <div class="timeRow">
    <span id="cur">1:43</span>
    <span id="tot">3:26</span>
  </div>

  <div id="lyricsBox">
    <label>æ­Œè© / ãƒ¡ãƒ¢</label>
    <textarea id="lyrics">çŸ­ã„ãƒ¡ãƒ¢ã‚„å¼•ç”¨ã€‚</textarea>
  </div>
</div>

<div class="panel">
  <canvas id="cvs" width="1080" height="1350"></canvas>
</div>
</div>

<div class="btnbar">
  <button onclick="render()">ç”Ÿæˆ</button>
  <button onclick="download()">PNGä¿å­˜</button>
</div>

<script>
const cvs=cvsEl=document.getElementById("cvs");
const ctx=cvs.getContext("2d");
let coverImg=null;

let state={
  theme:"dark",
  ui:"spotify",
  lyrics:true,
  frame:false
};

const themes={
  dark:{bg:"#0b1020",accent:"#53f3a6"},
  crimson:{bg:"#190812",accent:"#ff5a8c"},
  mono:{bg:"#0b0b0f",accent:"#fff"}
};

function fmt(s){s=Math.floor(s);return Math.floor(s/60)+":"+String(s%60).padStart(2,"0")}

document.querySelectorAll("[data-theme]").forEach(b=>{
  b.onclick=()=>{state.theme=b.dataset.theme;setChips("theme");render()}
});
document.querySelectorAll("[data-ui]").forEach(b=>{
  b.onclick=()=>{state.ui=b.dataset.ui;setChips("ui");render()}
});

toggleLyrics.onclick=()=>{
  state.lyrics=!state.lyrics;
  toggleLyrics.textContent=state.lyrics?"æ­Œè© ON":"æ­Œè© OFF";
  toggleLyrics.classList.toggle("on",state.lyrics);
  lyricsBox.style.display=state.lyrics?"block":"none";
  render();
};
toggleFrame.onclick=()=>{
  state.frame=!state.frame;
  toggleFrame.textContent=state.frame?"æ  ON":"æ  OFF";
  toggleFrame.classList.toggle("on",state.frame);
  render();
};

function setChips(type){
  document.querySelectorAll(`[data-${type}]`).forEach(b=>{
    b.classList.toggle("on",b.dataset[type]===state[type]);
  });
}

cover.onchange=e=>{
  const f=e.target.files[0];
  if(!f)return;
  const img=new Image();
  img.onload=()=>{coverImg=img;render()};
  img.src=URL.createObjectURL(f);
};

duration.oninput=()=>{pos.max=duration.value;tot.textContent=fmt(duration.value);render()}
pos.oninput=()=>{cur.textContent=fmt(pos.value);render()}

function rr(x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

function render(){
  const th=themes[state.theme];
  document.documentElement.style.setProperty("--bg",th.bg);
  document.documentElement.style.setProperty("--accent",th.accent);

  ctx.clearRect(0,0,cvs.width,cvs.height);
  ctx.fillStyle=th.bg;
  ctx.fillRect(0,0,cvs.width,cvs.height);

  const cx=90,cy=120,cw=cvs.width-180,ch=820;
  const mid=cx+cw/2;

  ctx.fillStyle="rgba(15,15,20,.85)";
  rr(cx,cy,cw,ch,40);ctx.fill();

  const cs=360;
  const ix=mid-cs/2,iy=cy+60;
  rr(ix,iy,cs,cs,24);
  ctx.fillStyle="rgba(255,255,255,.08)";ctx.fill();

  if(coverImg){
    ctx.save();rr(ix,iy,cs,cs,24);ctx.clip();
    ctx.drawImage(coverImg,ix,iy,cs,cs);ctx.restore();
  }

  ctx.textAlign="center";
  ctx.fillStyle="#fff";
  ctx.font=state.ui==="spotify"?"bold 36px sans-serif":"bold 42px sans-serif";
  ctx.fillText(title.value,mid,iy+cs+70);
  ctx.fillStyle="#bbb";
  ctx.font="24px sans-serif";
  ctx.fillText(artist.value,mid,iy+cs+110);

  const bw=420,by=iy+cs+170,ratio=pos.value/duration.value;
  rr(mid-bw/2,by,bw,10,6);
  ctx.fillStyle="rgba(255,255,255,.25)";ctx.fill();
  rr(mid-bw/2,by,bw*ratio,10,6);
  ctx.fillStyle=th.accent;ctx.fill();

  ctx.beginPath();
  ctx.arc(mid,by+60,34,0,Math.PI*2);
  ctx.fillStyle=th.accent;ctx.fill();
  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.moveTo(mid-8,by+46);
  ctx.lineTo(mid+14,by+60);
  ctx.lineTo(mid-8,by+74);
  ctx.closePath();ctx.fill();

  if(state.lyrics && lyrics.value.trim()){
    ctx.fillStyle="#ddd";
    ctx.font="22px sans-serif";
    ctx.textAlign="left";
    let y=cy+ch+40;
    lyrics.value.split("\n").forEach(l=>{ctx.fillText(l,cx+40,y);y+=32});
  }

  if(state.frame){
    ctx.strokeStyle="rgba(255,255,255,.4)";
    ctx.lineWidth=6;
    rr(40,40,cvs.width-80,cvs.height-80,50);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(cvs.width/2,40,14,0,Math.PI*2);
    ctx.stroke();
  }
}

function download(){
  render();
  const a=document.createElement("a");
  a.href=cvs.toDataURL();
  a.download="music-card.png";
  a.click();
}

duration.oninput();
pos.oninput();
render();
</script>
</body>
</html>
