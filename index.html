<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Music Card Maker</title>

<style>
:root{
  --bg:#0b1020;
  --ink:#e9ecff;
  --muted:#aab2d5;
  --accent:#53f3a6;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui,-apple-system,"Segoe UI","Noto Sans JP",sans-serif;
  background:var(--bg);
  color:var(--ink);
  padding-bottom:90px;
}
header{
  position:sticky;top:0;
  background:rgba(11,16,32,.7);
  backdrop-filter:blur(10px);
  padding:12px 14px;
  z-index:10;
}
.wrap{max-width:960px;margin:auto;padding:14px}
.panel{
  background:rgba(18,26,51,.55);
  border-radius:18px;
  padding:14px;
  margin-bottom:14px;
}
label{font-size:12px;color:var(--muted)}
input,textarea{
  width:100%;padding:12px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.1);
  border-radius:14px;
  color:var(--ink);
  font-size:16px;
}
textarea{min-height:120px}

input[type="range"]{
  -webkit-appearance:none;
  width:100%;
  height:6px;
  border-radius:999px;
  background:rgba(255,255,255,.25);
  outline:none;
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:22px;height:22px;
  border-radius:50%;
  background:var(--accent);
  cursor:pointer;
  border:none;
}
.timeRow{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  color:var(--muted);
}

canvas{width:100%;border-radius:18px}

.btnbar{
  position:fixed;left:0;right:0;bottom:0;
  background:rgba(11,16,32,.8);
  backdrop-filter:blur(10px);
  padding:10px;
  display:flex;gap:10px;
}
button{
  flex:1;
  padding:14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.15);
  background:rgba(83,243,166,.15);
  color:var(--ink);
  font-weight:800;
}
</style>
</head>

<body>
<header>ğŸ§ Music Card Maker</header>

<div class="wrap">
  <div class="panel">
    <label>æ›²å</label>
    <input id="title" value="æ˜¥é›·">

    <label>ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</label>
    <input id="artist" value="ç±³æ´¥ç„å¸«">

    <label>ã‚¸ãƒ£ã‚±å†™</label>
    <input type="file" id="cover" accept="image/*">

    <label>æ›²ã®é•·ã•ï¼ˆç§’ï¼‰</label>
    <input id="duration" type="number" value="206" min="1">

    <label>å†ç”Ÿä½ç½®</label>
    <input id="pos" type="range" min="0" value="103">
    <div class="timeRow">
      <span id="currentTime">1:43</span>
      <span id="totalTime">3:26</span>
    </div>

    <label>æ­Œè© / ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
    <textarea id="lyrics">çŸ­ã„ãƒ•ãƒ¬ãƒ¼ã‚ºã‚„ãƒ¡ãƒ¢ã€‚</textarea>
  </div>

  <div class="panel">
    <canvas id="cvs" width="1080" height="1350"></canvas>
  </div>
</div>

<div class="btnbar">
  <button onclick="render()">ç”Ÿæˆ</button>
  <button onclick="download()">PNGä¿å­˜</button>
</div>

<script>
const cvs = document.getElementById("cvs");
const ctx = cvs.getContext("2d");
let coverImg=null;

const posEl = document.getElementById("pos");
const durEl = document.getElementById("duration");

function fmt(sec){
  sec=Math.max(0,Math.floor(sec));
  return Math.floor(sec/60)+":"+String(sec%60).padStart(2,"0");
}

document.getElementById("cover").onchange=e=>{
  const f=e.target.files[0];
  if(!f)return;
  const img=new Image();
  img.onload=()=>{coverImg=img;render();}
  img.src=URL.createObjectURL(f);
};

durEl.oninput=()=>{
  posEl.max=durEl.value;
  document.getElementById("totalTime").textContent=fmt(durEl.value);
  render();
};

posEl.oninput=()=>{
  document.getElementById("currentTime").textContent=fmt(posEl.value);
  render();
};

function roundRect(x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

function render(){
  ctx.clearRect(0,0,cvs.width,cvs.height);
  ctx.fillStyle="#0b1020";
  ctx.fillRect(0,0,cvs.width,cvs.height);

  const cardX=90, cardY=120;
  const cardW=cvs.width-180;
  const cardH=820;
  const centerX=cardX+cardW/2;

  ctx.fillStyle="rgba(15,15,20,.85)";
  roundRect(cardX,cardY,cardW,cardH,40);
  ctx.fill();

  const coverSize=360;
  const cx=centerX-coverSize/2;
  const cy=cardY+60;

  roundRect(cx,cy,coverSize,coverSize,24);
  ctx.fillStyle="rgba(255,255,255,.08)";
  ctx.fill();

  if(coverImg){
    ctx.save();
    roundRect(cx,cy,coverSize,coverSize,24);
    ctx.clip();
    ctx.drawImage(coverImg,cx,cy,coverSize,coverSize);
    ctx.restore();
  }

  ctx.textAlign="center";
  ctx.fillStyle="#fff";
  ctx.font="bold 40px sans-serif";
  ctx.fillText(title.value, centerX, cy+coverSize+70);
  ctx.font="24px sans-serif";
  ctx.fillStyle="#bbb";
  ctx.fillText(artist.value, centerX, cy+coverSize+110);

  const barW=420;
  const barY=cy+coverSize+170;
  const ratio=posEl.value/durEl.value;

  ctx.fillStyle="rgba(255,255,255,.25)";
  roundRect(centerX-barW/2,barY,barW,10,6);
  ctx.fill();
  ctx.fillStyle="#53f3a6";
  roundRect(centerX-barW/2,barY,barW*ratio,10,6);
  ctx.fill();

  ctx.beginPath();
  ctx.arc(centerX,barY+60,34,0,Math.PI*2);
  ctx.fillStyle="#53f3a6";
  ctx.fill();
  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.moveTo(centerX-8,barY+46);
  ctx.lineTo(centerX+14,barY+60);
  ctx.lineTo(centerX-8,barY+74);
  ctx.closePath();
  ctx.fill();

  if(lyrics.value.trim()){
    ctx.fillStyle="#ddd";
    ctx.font="22px sans-serif";
    ctx.textAlign="left";
    let y=cardY+cardH+40;
    lyrics.value.split("\n").forEach(l=>{
      ctx.fillText(l,cardX+40,y);
      y+=32;
    });
  }

  ctx.strokeStyle="rgba(255,255,255,.4)";
  ctx.lineWidth=6;
  roundRect(40,40,cvs.width-80,cvs.height-80,50);
  ctx.stroke();

  ctx.beginPath();
  ctx.arc(cvs.width/2,40,14,0,Math.PI*2);
  ctx.stroke();
}

function download(){
  render();
  const a=document.createElement("a");
  a.href=cvs.toDataURL();
  a.download="music-card.png";
  a.click();
}

durEl.oninput();
posEl.oninput();
render();
</script>
</body>
</html>
